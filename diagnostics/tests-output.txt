  Determining projects to restore...
  All projects are up-to-date for restore.
  DatabaseRag.Api -> /home/runner/work/db-api-tunnel/db-api-tunnel/src/DatabaseRag.Api/bin/Debug/net8.0/DatabaseRag.Api.dll
  DatabaseRag.Api.Tests -> /home/runner/work/db-api-tunnel/db-api-tunnel/src/DatabaseRag.Api.Tests/bin/Debug/net8.0/DatabaseRag.Api.Tests.dll
Test run for /home/runner/work/db-api-tunnel/db-api-tunnel/src/DatabaseRag.Api.Tests/bin/Debug/net8.0/DatabaseRag.Api.Tests.dll (.NETCoreApp,Version=v8.0)
Microsoft (R) Test Execution Command Line Tool Version 17.8.0 (x64)
Copyright (c) Microsoft Corporation.  All rights reserved.

Starting test execution, please wait...
A total of 1 test files matched the specified pattern.
[DEBUG] Cosmos Query: SELECT * FROM c
[DEBUG] Database: TestDb, Container: TestContainer
info: Microsoft.AspNetCore.Hosting.Diagnostics[1]
      Request starting HTTP/1.1 GET http://localhost/api/cosmos/nonexistent - - -
info: Microsoft.AspNetCore.Hosting.Diagnostics[1]
      Request starting HTTP/1.1 POST http://localhost/api/cosmos/query - application/json;+charset=utf-8 70
warn: Microsoft.AspNetCore.HttpsPolicy.HttpsRedirectionMiddleware[3]
      Failed to determine the https port for redirect.
warn: Microsoft.AspNetCore.HttpsPolicy.HttpsRedirectionMiddleware[3]
      Failed to determine the https port for redirect.
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[0]
      Executing endpoint 'HTTP: POST /api/cosmos/query'
info: Microsoft.AspNetCore.Hosting.Diagnostics[2]
      Request finished HTTP/1.1 GET http://localhost/api/cosmos/nonexistent - 404 - - 82.8550ms
info: Microsoft.AspNetCore.Hosting.Diagnostics[16]
      Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost/api/cosmos/nonexistent, Response status code: 404
info: Microsoft.AspNetCore.Hosting.Diagnostics[1]
      Request starting HTTP/1.1 GET http://localhost/api/nonexistent - - -
info: Microsoft.AspNetCore.Http.Result.BadRequestObjectResult[1]
      Setting HTTP status code 400.
info: Microsoft.AspNetCore.Hosting.Diagnostics[2]
      Request finished HTTP/1.1 GET http://localhost/api/nonexistent - 404 - - 1.8081ms
info: Microsoft.AspNetCore.Hosting.Diagnostics[16]
      Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost/api/nonexistent, Response status code: 404
info: Microsoft.AspNetCore.Http.Result.BadRequestObjectResult[3]
      Writing value of type '<>f__AnonymousType0`1' as Json.
info: Microsoft.AspNetCore.Hosting.Diagnostics[1]
      Request starting HTTP/1.1 GET http://localhost/api/sql/nonexistent - - -
info: Microsoft.AspNetCore.Hosting.Diagnostics[2]
      Request finished HTTP/1.1 GET http://localhost/api/sql/nonexistent - 404 - - 1.0732ms
info: Microsoft.AspNetCore.Hosting.Diagnostics[16]
      Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost/api/sql/nonexistent, Response status code: 404
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[1]
      Executed endpoint 'HTTP: POST /api/cosmos/query'
info: Microsoft.AspNetCore.Hosting.Diagnostics[2]
      Request finished HTTP/1.1 POST http://localhost/api/cosmos/query - 400 - application/json;+charset=utf-8 113.4064ms
info: Microsoft.AspNetCore.Hosting.Diagnostics[1]
      Request starting HTTP/1.1 POST http://localhost/api/sql/query - application/json;+charset=utf-8 12
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[0]
      Executing endpoint 'HTTP: POST /api/sql/query'
info: Microsoft.AspNetCore.Hosting.Diagnostics[1]
      Request starting HTTP/1.1 POST http://localhost/api/cosmos/query - application/json;+charset=utf-8 83
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[1]
      Executed endpoint 'HTTP: POST /api/sql/query'
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[0]
      Executing endpoint 'HTTP: POST /api/cosmos/query'
info: Microsoft.AspNetCore.Http.Result.BadRequestObjectResult[1]
      Setting HTTP status code 400.
info: Microsoft.AspNetCore.Http.Result.BadRequestObjectResult[3]
      Writing value of type '<>f__AnonymousType0`1' as Json.
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[1]
      Executed endpoint 'HTTP: POST /api/cosmos/query'
info: Microsoft.AspNetCore.Hosting.Diagnostics[2]
      Request finished HTTP/1.1 POST http://localhost/api/cosmos/query - 400 - application/json;+charset=utf-8 2.7639ms
info: Microsoft.AspNetCore.Hosting.Diagnostics[1]
      Request starting HTTP/1.1 POST http://localhost/api/cosmos/query - application/json;+charset=utf-8 83
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[0]
      Executing endpoint 'HTTP: POST /api/cosmos/query'
[DEBUG] Cosmos Query: SELECT * FROM c
[DEBUG] Database: TestDb, Container: TestContainer
info: Microsoft.AspNetCore.Http.Result.OkObjectResult[1]
      Setting HTTP status code 200.
fail: Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware[1]
      An unhandled exception has occurred while executing the request.
      Microsoft.AspNetCore.Http.BadHttpRequestException: Failed to read parameter "SqlQueryRequest request" from the request body as JSON.
       ---> System.Text.Json.JsonException: 'i' is an invalid start of a value. Path: $ | LineNumber: 0 | BytePositionInLine: 0.
       ---> System.Text.Json.JsonReaderException: 'i' is an invalid start of a value. LineNumber: 0 | BytePositionInLine: 0.
         at System.Text.Json.ThrowHelper.ThrowJsonReaderException(Utf8JsonReader& json, ExceptionResource resource, Byte nextByte, ReadOnlySpan`1 bytes)
         at System.Text.Json.Utf8JsonReader.ConsumeValue(Byte marker)
         at System.Text.Json.Utf8JsonReader.ReadFirstToken(Byte first)
         at System.Text.Json.Utf8JsonReader.ReadSingleSegment()
         at System.Text.Json.Utf8JsonReader.Read()
         at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, JsonSerializerOptions options, ReadStack& state)
         --- End of inner exception stack trace ---
         at System.Text.Json.ThrowHelper.ReThrowWithPath(ReadStack& state, JsonReaderException ex)
         at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, JsonSerializerOptions options, ReadStack& state)
         at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.ContinueDeserialize(ReadBufferState& bufferState, JsonReaderState& jsonReaderState, ReadStack& readStack)
         at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
         at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
         at Microsoft.AspNetCore.Http.HttpRequestJsonExtensions.ReadFromJsonAsync(HttpRequest request, JsonTypeInfo jsonTypeInfo, CancellationToken cancellationToken)
         at Microsoft.AspNetCore.Http.HttpRequestJsonExtensions.ReadFromJsonAsync(HttpRequest request, JsonTypeInfo jsonTypeInfo, CancellationToken cancellationToken)
         at Microsoft.AspNetCore.Http.RequestDelegateFactory.<HandleRequestBodyAndCompileRequestDelegateForJson>g__TryReadBodyAsync|102_0(HttpContext httpContext, Type bodyType, String parameterTypeName, String parameterName, Boolean allowEmptyRequestBody, Boolean throwOnBadRequest, JsonTypeInfo jsonTypeInfo)
         --- End of inner exception stack trace ---
         at Microsoft.AspNetCore.Http.RequestDelegateFactory.Log.InvalidJsonRequestBody(HttpContext httpContext, String parameterTypeName, String parameterName, Exception exception, Boolean shouldThrow)
         at Microsoft.AspNetCore.Http.RequestDelegateFactory.<HandleRequestBodyAndCompileRequestDelegateForJson>g__TryReadBodyAsync|102_0(HttpContext httpContext, Type bodyType, String parameterTypeName, String parameterName, Boolean allowEmptyRequestBody, Boolean throwOnBadRequest, JsonTypeInfo jsonTypeInfo)
         at Microsoft.AspNetCore.Http.RequestDelegateFactory.<>c__DisplayClass102_2.<<HandleRequestBodyAndCompileRequestDelegateForJson>b__2>d.MoveNext()
      --- End of stack trace from previous location ---
         at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
         at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
         at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
         at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
info: Microsoft.AspNetCore.Hosting.Diagnostics[2]
      Request finished HTTP/1.1 POST http://localhost/api/sql/query - 400 - text/plain;+charset=utf-8 16.3230ms
info: Microsoft.AspNetCore.Http.Result.OkObjectResult[3]
      Writing value of type 'GenericQueryResponse' as Json.
info: Microsoft.AspNetCore.Hosting.Diagnostics[1]
      Request starting HTTP/1.1 POST http://localhost/api/sql/schema - application/json;+charset=utf-8 0
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[0]
      Executing endpoint 'HTTP: POST /api/sql/schema'
info: Microsoft.AspNetCore.Http.Result.BadRequestObjectResult[1]
      Setting HTTP status code 400.
info: Microsoft.AspNetCore.Http.Result.BadRequestObjectResult[3]
      Writing value of type '<>f__AnonymousType0`1' as Json.
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[1]
      Executed endpoint 'HTTP: POST /api/sql/schema'
info: Microsoft.AspNetCore.Hosting.Diagnostics[2]
      Request finished HTTP/1.1 POST http://localhost/api/sql/schema - 400 - application/json;+charset=utf-8 1.9608ms
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[1]
      Executed endpoint 'HTTP: POST /api/cosmos/query'
info: Microsoft.AspNetCore.Hosting.Diagnostics[2]
      Request finished HTTP/1.1 POST http://localhost/api/cosmos/query - 200 - application/json;+charset=utf-8 17.6269ms
info: Microsoft.AspNetCore.Hosting.Diagnostics[1]
      Request starting HTTP/1.1 GET http://localhost/health - - -
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[0]
      Executing endpoint 'HTTP: GET /health'
info: Microsoft.AspNetCore.Http.Result.OkObjectResult[1]
      Setting HTTP status code 200.
info: Microsoft.AspNetCore.Hosting.Diagnostics[1]
      Request starting HTTP/1.1 POST http://localhost/api/cosmos/query - application/json;+charset=utf-8 77
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[0]
      Executing endpoint 'HTTP: POST /api/cosmos/query'
info: Microsoft.AspNetCore.Http.Result.BadRequestObjectResult[1]
      Setting HTTP status code 400.
info: Microsoft.AspNetCore.Http.Result.BadRequestObjectResult[3]
      Writing value of type '<>f__AnonymousType0`1' as Json.
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[1]
      Executed endpoint 'HTTP: POST /api/cosmos/query'
info: Microsoft.AspNetCore.Hosting.Diagnostics[2]
      Request finished HTTP/1.1 POST http://localhost/api/cosmos/query - 400 - application/json;+charset=utf-8 0.8771ms
info: Microsoft.AspNetCore.Http.Result.OkObjectResult[3]
      Writing value of type 'HealthResponse' as Json.
info: Microsoft.AspNetCore.Hosting.Diagnostics[1]
      Request starting HTTP/1.1 POST http://localhost/api/cosmos/query - application/json;+charset=utf-8 68
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[0]
      Executing endpoint 'HTTP: POST /api/cosmos/query'
info: Microsoft.AspNetCore.Http.Result.BadRequestObjectResult[1]
      Setting HTTP status code 400.
info: Microsoft.AspNetCore.Http.Result.BadRequestObjectResult[3]
      Writing value of type '<>f__AnonymousType0`1' as Json.
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[1]
      Executed endpoint 'HTTP: POST /api/cosmos/query'
info: Microsoft.AspNetCore.Hosting.Diagnostics[2]
      Request finished HTTP/1.1 POST http://localhost/api/cosmos/query - 400 - application/json;+charset=utf-8 0.2319ms
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[1]
      Executed endpoint 'HTTP: GET /health'
info: Microsoft.AspNetCore.Hosting.Diagnostics[2]
      Request finished HTTP/1.1 GET http://localhost/health - 200 - application/json;+charset=utf-8 6.9901ms
info: Microsoft.AspNetCore.Hosting.Diagnostics[1]
      Request starting HTTP/1.1 POST http://localhost/api/cosmos/query - application/json;+charset=utf-8 83
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[0]
      Executing endpoint 'HTTP: POST /api/cosmos/query'
[DEBUG] Cosmos Query: SELECT * FROM c
[DEBUG] Database: TestDb, Container: TestContainer
info: Microsoft.AspNetCore.Http.Result.OkObjectResult[1]
      Setting HTTP status code 200.
info: Microsoft.AspNetCore.Http.Result.OkObjectResult[3]
      Writing value of type 'GenericQueryResponse' as Json.
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[1]
      Executed endpoint 'HTTP: POST /api/cosmos/query'
info: Microsoft.AspNetCore.Hosting.Diagnostics[2]
      Request finished HTTP/1.1 POST http://localhost/api/cosmos/query - 200 - application/json;+charset=utf-8 0.6469ms
info: Microsoft.AspNetCore.Hosting.Diagnostics[1]
      Request starting HTTP/1.1 POST http://localhost/api/cosmos/schema - application/json;+charset=utf-8 2
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[0]
      Executing endpoint 'HTTP: POST /api/cosmos/schema'
info: Microsoft.AspNetCore.Http.Result.BadRequestObjectResult[1]
      Setting HTTP status code 400.
info: Microsoft.AspNetCore.Http.Result.BadRequestObjectResult[3]
      Writing value of type '<>f__AnonymousType0`1' as Json.
info: Microsoft.AspNetCore.Routing.EndpointMiddleware[1]
      Executed endpoint 'HTTP: POST /api/cosmos/schema'
info: Microsoft.AspNetCore.Hosting.Diagnostics[2]
      Request finished HTTP/1.1 POST http://localhost/api/cosmos/schema - 400 - application/json;+charset=utf-8 2.5419ms
info: Microsoft.AspNetCore.Hosting.Diagnostics[1]
      Request starting HTTP/1.1 GET http://localhost/swagger/index.html - - -
info: Microsoft.AspNetCore.Hosting.Diagnostics[2]
      Request finished HTTP/1.1 GET http://localhost/swagger/index.html - 200 - text/html;charset=utf-8 44.1298ms
Results File: /home/runner/work/db-api-tunnel/db-api-tunnel/src/DatabaseRag.Api.Tests/TestResults/test-results.xml

Passed!  - Failed:     0, Passed:    30, Skipped:     0, Total:    30, Duration: 395 ms - DatabaseRag.Api.Tests.dll (net8.0)
